spring:
  application:
    name: transaction-app

  shardingsphere:
    datasource:
      names: ds_0, ds_1

      ds_0:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: org.postgresql.Driver
        jdbc-url: jdbc:postgresql://shardingsphere-proxy:3307/sharding_db
        username: sharding_user
        password: SecurePass123!

      ds_1:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: org.postgresql.Driver
        jdbc-url: jdbc:postgresql://shardingsphere-proxy:3307/sharding_db
        username: sharding_user
        password: SecurePass123!

    rules:
      sharding:
        tables:
          wallets:
            actual-data-nodes: ds_${0..1}.wallets_${0..1}
            database-strategy:
              standard:
                sharding-column: user_uid
                sharding-algorithm-name: db-inline
            table-strategy:
              standard:
                sharding-column: user_uid
                sharding-algorithm-name: wallet-inline

          transactions:
            actual-data-nodes: ds_${0..1}.transactions_${0..1}
            database-strategy:
              standard:
                sharding-column: user_uid
                sharding-algorithm-name: db-inline
            table-strategy:
              standard:
                sharding-column: user_uid
                sharding-algorithm-name: tx-inline

        sharding-algorithms:
          db-inline:
            type: INLINE
            props:
              algorithm-expression: ds_${Math.abs(user_uid.hashCode()) % 2}

          wallet-inline:
            type: INLINE
            props:
              algorithm-expression: wallets_${Math.abs(user_uid.hashCode()) % 2}

          tx-inline:
            type: INLINE
            props:
              algorithm-expression: transactions_${Math.abs(user_uid.hashCode()) % 2}

    props:
      sql-show: true

  jpa:
    hibernate:
      ddl-auto: none
      database-platform: org.hibernate.dialect.PostgreSQLDialect
    show-sql: false
    open-in-view: false

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus

  endpoint:
    health:
      show-details: always
    prometheus:
      access: read_only

  metrics:
    tags:
      application: ${spring.application.name}
      environment: ${ENV:development}
    export:
      prometheus:
        enabled: true

  tracing:
    sampling:
      probability: 1.0

otel:
  exporter:
    otlp:
      endpoint: ${OTLP_EXPORTER_ENDPOINT:http://localhost:4318}
      protocol: http/protobuf
  logs:
    exporter: none
  metrics:
    exporter: none

logging:
  level:
    root: INFO
    org.springframework: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

individuals:
  api:
    url: http://localhost:8081/api/v1
    connect-timeout: 5000
    read-timeout: 10000
